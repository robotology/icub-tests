<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>icub-test: Writing and Running Tests</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">icub-test
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Writing and Running Tests </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#writing-new-tests">Writing a new test</a></li>
<li class="level1"><a href="#running_single_test_case">Running a single test case</a></li>
<li class="level1"><a href="#running_multiple_tests">Running multiple tests using a test suite</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="writing-new-tests"></a>
Writing a new test</h1>
<p>Create a folder with the name of your test case in the <code>icub-tests/src/</code> folder to keep your test codes:</p>
<div class="fragment"><div class="line">$ mkdir icub-tests/src/example-test</div>
</div><!-- fragment --><p>Create a child test class inherited from the <code>YarpTestCase</code>:</p>
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * iCub Robot Unit Tests (Robot Testing Framework)</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright (C) 2015-2019 Istituto Italiano di Tecnologia (IIT)</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This library is free software; you can redistribute it and/or</span></div>
<div class="line"><span class="comment"> * modify it under the terms of the GNU Lesser General Public</span></div>
<div class="line"><span class="comment"> * License as published by the Free Software Foundation; either</span></div>
<div class="line"><span class="comment"> * version 2.1 of the License, or (at your option) any later version.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This library is distributed in the hope that it will be useful,</span></div>
<div class="line"><span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span></div>
<div class="line"><span class="comment"> * Lesser General Public License for more details.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * You should have received a copy of the GNU Lesser General Public</span></div>
<div class="line"><span class="comment"> * License along with this library; if not, write to the Free Software</span></div>
<div class="line"><span class="comment"> * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifndef _EXAMPLE_TEST_H_</span></div>
<div class="line"><span class="preprocessor">#define _EXAMPLE_TEST_H_</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;yarp/robottestingframework/TestCase.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span><a class="code" href="classExampleTest.html">ExampleTest</a> : <span class="keyword">public</span> yarp::robottestingframework::TestCase {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <a class="code" href="classExampleTest.html">ExampleTest</a>();</div>
<div class="line">    <span class="keyword">virtual</span> ~<a class="code" href="classExampleTest.html">ExampleTest</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> setup(yarp::os::Property&amp; property);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> tearDown();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> run();</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">//_EXAMPLE_TEST_H</span></div>
<div class="ttc" id="aclassExampleTest_html"><div class="ttname"><a href="classExampleTest.html">ExampleTest</a></div><div class="ttdoc">This is just an example test, use it as a reference to implement new tests.</div><div class="ttdef"><b>Definition:</b> <a href="ExampleTest_8h_source.html#l00041">ExampleTest.h:41</a></div></div>
</div><!-- fragment --><p>Implement the test case:</p>
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * iCub Robot Unit Tests (Robot Testing Framework)</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright (C) 2015-2019 Istituto Italiano di Tecnologia (IIT)</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This library is free software; you can redistribute it and/or</span></div>
<div class="line"><span class="comment"> * modify it under the terms of the GNU Lesser General Public</span></div>
<div class="line"><span class="comment"> * License as published by the Free Software Foundation; either</span></div>
<div class="line"><span class="comment"> * version 2.1 of the License, or (at your option) any later version.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This library is distributed in the hope that it will be useful,</span></div>
<div class="line"><span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span></div>
<div class="line"><span class="comment"> * Lesser General Public License for more details.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * You should have received a copy of the GNU Lesser General Public</span></div>
<div class="line"><span class="comment"> * License along with this library; if not, write to the Free Software</span></div>
<div class="line"><span class="comment"> * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;ExampleTest.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;robottestingframework/dll/Plugin.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;robottestingframework/TestAssert.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span>std;</div>
<div class="line"><span class="keyword">using namespace </span>robottestingframework;</div>
<div class="line"><span class="keyword">using namespace </span>yarp::os;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// prepare the plugin</span></div>
<div class="line">ROBOTTESTINGFRAMEWORK_PREPARE_PLUGIN(<a class="code" href="classExampleTest.html">ExampleTest</a>)</div>
<div class="line"> </div>
<div class="line">ExampleTest::ExampleTest() : yarp::robottestingframework::TestCase(<span class="stringliteral">&quot;ExampleTest&quot;</span>) {</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">ExampleTest::~ExampleTest() { }</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> ExampleTest::setup(yarp::os::Property &amp;property) {</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// initialization goes here ...</span></div>
<div class="line">    <span class="comment">//updating the test name</span></div>
<div class="line">    <span class="keywordflow">if</span>(property.check(<span class="stringliteral">&quot;name&quot;</span>))</div>
<div class="line">        setName(property.find(<span class="stringliteral">&quot;name&quot;</span>).asString());</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">string</span> example = <span class="keyword">property</span>.check(<span class="stringliteral">&quot;example&quot;</span>, Value(<span class="stringliteral">&quot;default value&quot;</span>)).asString();</div>
<div class="line"> </div>
<div class="line">    ROBOTTESTINGFRAMEWORK_TEST_REPORT(Asserter::format(<span class="stringliteral">&quot;Use &#39;%s&#39; for the example param!&quot;</span>,</div>
<div class="line">                                       example.c_str()));</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> ExampleTest::tearDown() {</div>
<div class="line">    <span class="comment">// finalization goes her ...</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> ExampleTest::run() {</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> a = 5; <span class="keywordtype">int</span> b = 3;</div>
<div class="line">    ROBOTTESTINGFRAMEWORK_TEST_CHECK(a&lt;b, <span class="stringliteral">&quot;a smaller then b&quot;</span>);</div>
<div class="line">    ROBOTTESTINGFRAMEWORK_TEST_CHECK(a&gt;b, <span class="stringliteral">&quot;a bigger then b&quot;</span>);</div>
<div class="line">    ROBOTTESTINGFRAMEWORK_TEST_CHECK(a==b, <span class="stringliteral">&quot;a equal to b&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// add more</span></div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line">}</div>
<div class="line"> </div>
</div><!-- fragment --><p>Notice: The <code>ROBOTTESTINGFRAMEWORK_TEST_CHECK</code>, <code>ROBOTTESTINGFRAMEWORK_TEST_REPORT</code> do NOT threw any exception and are used to add failure or report messages to the result collector. Instead, all the macros which include <code>_ASSERT_</code> within their names (e.g., <code>ROBOTTESTINGFRAMEWORK_ASSERT_FAIL</code>) throw exceptions which prevent only the current test case (Not the whole test suite) of being proceed. The error/failure messages thrown by the exceptions are caught. (See <a href="http://robotology.github.io/robot-testing-framework/documentation/TestAssert_8h.html"><em>Basic Assertion macros</em></a>).</p>
<p>The report/assertion macros store the source line number where the check/report or assertion happen. To see them, you can run the test case or suite with <code>--detail</code> parameter using the <code>robottestingframework-testrunner</code> (See <a href="http://robotology.github.io/robot-testing-framework/documentation/robottestingframework-testrunner.html"><em>Running test case plug-ins using robottestingframework-testrunner</em></a>).</p>
<p>Create a cmake file to build the plug-in:</p>
<div class="fragment"><div class="line"><span class="preprocessor"># iCub Robot Unit Tests (Robot Testing Framework)</span></div>
<div class="line"><span class="preprocessor">#</span></div>
<div class="line"><span class="preprocessor"># Copyright (C) 2015-2019 Istituto Italiano di Tecnologia (IIT)</span></div>
<div class="line"><span class="preprocessor">#</span></div>
<div class="line"><span class="preprocessor"># This library is free software; you can redistribute it and/or</span></div>
<div class="line"><span class="preprocessor"># modify it under the terms of the GNU Lesser General Public</span></div>
<div class="line"><span class="preprocessor"># License as published by the Free Software Foundation; either</span></div>
<div class="line"><span class="preprocessor"># version 2.1 of the License, or (at your option) any later version.</span></div>
<div class="line"><span class="preprocessor">#</span></div>
<div class="line"><span class="preprocessor"># This library is distributed in the hope that it will be useful,</span></div>
<div class="line"><span class="preprocessor"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><span class="preprocessor"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span></div>
<div class="line"><span class="preprocessor"># Lesser General Public License for more details.</span></div>
<div class="line"><span class="preprocessor">#</span></div>
<div class="line"><span class="preprocessor"># You should have received a copy of the GNU Lesser General Public</span></div>
<div class="line"><span class="preprocessor"># License along with this library; if not, write to the Free Software</span></div>
<div class="line"><span class="preprocessor"># Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span>(NOT DEFINED CMAKE_MINIMUM_REQUIRED_VERSION)</div>
<div class="line">  cmake_minimum_required(VERSION 3.5)</div>
<div class="line">endif()</div>
<div class="line"> </div>
<div class="line">project(<a class="code" href="classExampleTest.html">ExampleTest</a>)</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># add the required cmake packages</span></div>
<div class="line">find_package(RobotTestingFramework 2 COMPONENTS DLL)</div>
<div class="line">find_package(YARP 3.5.1 COMPONENTS os robottestingframework)</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># add the source codes to build the plugin library</span></div>
<div class="line">add_library(${PROJECT_NAME} MODULE <a class="code" href="classExampleTest.html">ExampleTest</a>.h</div>
<div class="line">                                   <a class="code" href="classExampleTest.html">ExampleTest</a>.cpp)</div>
<div class="line"> </div>
<div class="line"># add required libraries</div>
<div class="line">target_link_libraries(${PROJECT_NAME} RobotTestingFramework::RTF</div>
<div class="line">                                      RobotTestingFramework::RTF_dll</div>
<div class="line">                                      YARP::YARP_os</div>
<div class="line">                                      YARP::YARP_init</div>
<div class="line">                                      YARP::YARP_robottestingframework)</div>
<div class="line"> </div>
<div class="line"># set the installation options</div>
<div class="line">install(TARGETS ${PROJECT_NAME}</div>
<div class="line">        EXPORT ${PROJECT_NAME}</div>
<div class="line">        COMPONENT runtime</div>
<div class="line">        LIBRARY DESTINATION lib)</div>
<div class="line"> </div>
</div><!-- fragment --><p>Call your cmake file from the <code>icub-test/CMakeLists.txt</code> to build it along with the other other test plugins. To do that, adds the following line to the <code>icub-test/CMakeLists.txt</code></p>
<div class="fragment"><div class="line"><span class="preprocessor"># Build example test</span></div>
<div class="line"><span class="preprocessor">add_subdirectory(src/example-test)</span></div>
</div><!-- fragment --><p>Please check the <code>icub-tests/example</code> folder for a template for developing tests for the iCub.</p>
<h1><a class="anchor" id="running_single_test_case"></a>
Running a single test case</h1>
<p>As it is documented here (<a href="http://robotology.github.io/robot-testing-framework/documentation/robottestingframework-testrunner.html"><em>Running test case plug-ins using robottestingframework-testrunner</em></a>) you can run a single test case or run it with the other tests using a test suite. For example, to run a single test case:</p>
<div class="fragment"><div class="line">robottestingframework-testrunner --verbose --test plugins/<a class="code" href="classExampleTest.html">ExampleTest</a>.so  --param <span class="stringliteral">&quot;--name MyExampleTest&quot;</span></div>
</div><!-- fragment --><p>Notice that this test require the <code>yarpserver</code> to be running and it contains tests that are programmed to succeed and some that are programmed to fail.</p>
<p>or to run the iCubSim camera test whith the test configuration file:</p>
<div class="fragment"><div class="line">robottestingframework-testrunner --verbose --test plugins/<a class="code" href="classCameraTest.html">CameraTest</a>.so --param <span class="stringliteral">&quot;--from camera_right.ini&quot;</span> --environment <span class="stringliteral">&quot;--robotname icubSim&quot;</span></div>
<div class="ttc" id="aclassCameraTest_html"><div class="ttname"><a href="classCameraTest.html">CameraTest</a></div><div class="ttdoc">Check if a camera is publishing images at desired framerate.</div><div class="ttdef"><b>Definition:</b> <a href="CameraTest_8h_source.html#l00044">CameraTest.h:44</a></div></div>
</div><!-- fragment --><p>This runs the icubSim right-camera test with the parameters specified in the <code>right_camera.ini</code> which can be found in <code>icub-tests/suites/contexts/icubSim</code> folder. This test assumes you are running <code>yarpserver</code> and the iCub simulator (i.e. <code>iCub_SIM</code>).</p>
<p>Notice that the environment parameter <code>--robotname icubSim</code> is used to locate the correct context (for this examples is <code>icubSim</code>) and also to update the variables loaded from the <code>right_camera.ini</code> file.</p>
<h1><a class="anchor" id="running_multiple_tests"></a>
Running multiple tests using a test suite</h1>
<p>You can update one of the existing suite XML files to add your test case plug-in and its parameters or create a new test suite which keeps all the relevant test cases. For example the <code>basic-icubSim.xml</code> test suite keeps the basic tests for cameras and motors:</p>
<div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span> encoding=<span class="stringliteral">&quot;UTF-8&quot;</span>?&gt;</div>
<div class="line"> </div>
<div class="line">&lt;suite name=<span class="stringliteral">&quot;Basic Tests Suite&quot;</span>&gt;</div>
<div class="line">    &lt;description&gt;Testing robot<span class="stringliteral">&#39;s basic features&lt;/description&gt;</span></div>
<div class="line"><span class="stringliteral">    &lt;environment&gt;--robotname icubSim&lt;/environment&gt;</span></div>
<div class="line"><span class="stringliteral">    &lt;fixture param=&quot;--fixture icubsim-fixture.xml&quot;&gt; yarpmanager &lt;/fixture&gt;</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">    &lt;!-- Camera --&gt;</span></div>
<div class="line"><span class="stringliteral">    &lt;test type=&quot;dll&quot; param=&quot;--from right_camera.ini&quot;&gt; CameraTest &lt;/test&gt;</span></div>
<div class="line"><span class="stringliteral">    &lt;test type=&quot;dll&quot; param=&quot;--from left_camera.ini&quot;&gt; CameraTest &lt;/test&gt;</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">    &lt;!-- Motors --&gt;</span></div>
<div class="line"><span class="stringliteral">    &lt;test type=&quot;dll&quot; param=&quot;--from test_right_arm.ini&quot;&gt; MotorTest &lt;/test&gt;</span></div>
<div class="line"><span class="stringliteral">    &lt;test type=&quot;dll&quot; param=&quot;--from test_left_arm.ini&quot;&gt; MotorTest &lt;/test&gt;</span></div>
<div class="line"><span class="stringliteral">&lt;/suite&gt;</span></div>
</div><!-- fragment --><p>Then you can run all the test cases from the test suite:</p>
<div class="fragment"><div class="line">robottestingframework-testrunner --verbose --suite icub-tests/suites/basics-icubSim.xml</div>
</div><!-- fragment --><p>The <code>robottestingframework-testrunner</code>, first, launches the iCub simulator and then runs all the tests one after each other. After running all the test cases, the <code>tesrunner</code> stop the simulator. If the iCub simulator crashes during the test run, the <code>robottestingframework-testrunner</code> re-launchs it and continues running the remaining tests.</p>
<p>How <code>robottestingframework-testrunner</code> knows that it should launch the iCub simulator before running the tests? Well, this is indicated by <code>&lt;fixture param="--fixture icubsim-fixture.xml"&gt; yarpmanager &lt;/fixture&gt;</code>. The <code>robottestingframework-testrunner</code> uses the <code>yarpmanager</code> fixture plug-in to launch the modules which are listed in the <code>icubsim-fixture.xml</code>. Notice that all the fixture files should be located in the <code>icub-tests/suites/fixtures</code> folder. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
